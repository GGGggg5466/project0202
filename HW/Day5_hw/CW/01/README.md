# ğŸ“š Day5 HW â€“ RAG Pipeline (Embedding â†’ Qdrant â†’ LLM)

æœ¬ä½œæ¥­å¯¦ä½œä¸€å€‹ **å®Œæ•´çš„ Retrieval-Augmented Generation (RAG) æµç¨‹**ï¼Œå¾æ–‡å­—å‘é‡åŒ–ï¼ˆEmbeddingï¼‰ã€å‘é‡è³‡æ–™åº«å„²å­˜èˆ‡æœå°‹ï¼ˆQdrantï¼‰ï¼Œåˆ°çµåˆé›²ç«¯ LLM ç”¢ç”Ÿæœ€çµ‚å›ç­”ã€‚

---

## ğŸ¯ ä½œæ¥­ç›®æ¨™

- ä½¿ç”¨ **Embedding æ¨¡å‹** å°‡æ–‡å­—è½‰æ›ç‚ºå‘é‡
- å»ºç«‹ä¸¦æ“ä½œ **Qdrant å‘é‡è³‡æ–™åº«**
- å¯¦ä½œ **Top-k èªæ„æœå°‹**
- å°‡æœå°‹çµæœä½œç‚º contextï¼Œå®Œæˆ **RAG å•ç­”æµç¨‹**
- æ¡ç”¨ **æ¨¡çµ„åŒ– Step æ¶æ§‹**ï¼Œæ¯å€‹æ­¥é©Ÿå¯ç¨ç«‹æ¸¬è©¦èˆ‡é™¤éŒ¯

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```text
HW/Day5_hw/
â”œâ”€ cw01_step3_get_embeddings.py
â”‚   â””â”€ Step 3ï¼šæ‰¹æ¬¡å–å¾—æ–‡å­— Embeddingsï¼ˆä½¿ç”¨å­¸é•·æä¾›çš„ APIï¼‰
â”œâ”€ cw01_step4_upsert_to_qdrant.py
â”‚   â””â”€ Step 4ï¼šå°‡å‘é‡èˆ‡ payload ä¸Šå‚³è‡³ Qdrant
â”œâ”€ cw01_step5_search_from_qdrant.py
â”‚   â””â”€ Step 5ï¼šä½¿ç”¨ Qdrant é€²è¡Œ Top-k èªæ„æœå°‹
â”œâ”€ cw01_step6_rag_generate_cloud_llm.py
â”‚   â””â”€ Step 6ï¼šRAGï¼ˆæª¢ç´¢ + é›²ç«¯ LLMï¼‰ç”¢ç”Ÿæœ€çµ‚å›ç­”
â””â”€ embeddings.json
    â””â”€ Step 3 è¼¸å‡ºçš„ä¸­é–“çµæœï¼ˆæ–‡å­— + å‘é‡ï¼‰
```

## ğŸ§  RAG æ•´é«”æµç¨‹èªªæ˜

åŸå§‹æ–‡å­—è³‡æ–™
   â†“
Embeddingï¼ˆæ–‡å­—è½‰å‘é‡ï¼‰
   â†“
Qdrantï¼ˆå‘é‡è³‡æ–™åº«ï¼‰
   â†“
Top-k èªæ„æœå°‹
   â†“
å–å¾—ç›¸é—œ context
   â†“
é›²ç«¯ LLM ç”Ÿæˆå›ç­”ï¼ˆRAGï¼‰

## Step 3ï¼šå–å¾— Embeddingsï¼ˆBatch + Functionï¼‰

**æª”æ¡ˆï¼š** `cw01_step3_get_embeddings.py`

æœ¬æ­¥é©Ÿè² è²¬å°‡åŸå§‹æ–‡å­—è³‡æ–™è½‰æ›ç‚ºå‘é‡ï¼ˆEmbeddingï¼‰ï¼Œä½œç‚ºå¾ŒçºŒå‘é‡æœå°‹èˆ‡ RAG çš„åŸºç¤ã€‚

### ä½œæ³•èªªæ˜
- ä½¿ç”¨å­¸é•·æä¾›çš„ **é›²ç«¯ Embedding API**
- å°‡ embedding è¡Œç‚ºå°è£æˆå‡½æ•¸
- æ”¯æ´ **æ‰¹æ¬¡ï¼ˆbatchï¼‰ä¸Šå‚³**
- çµ±ä¸€è¼¸å‡ºç‚º `embeddings.json`

### ç‚ºä»€éº¼éœ€è¦ Embeddingï¼Ÿ
- LLM ç„¡æ³•ç›´æ¥æ¯”è¼ƒæ–‡å­—èªæ„
- Embedding æœƒå°‡æ–‡å­—è½‰ç‚ºé«˜ç¶­å‘é‡ï¼ˆæœ¬ä½œæ¥­ç‚º **4096 ç¶­**ï¼‰
- å‘é‡å¯ç”¨æ–¼ç›¸ä¼¼åº¦æœå°‹ï¼ˆTop-kï¼‰

### è¼¸å‡ºæª”æ¡ˆ
`embeddings.json` å…§å®¹åŒ…å«ï¼š
- dimï¼ˆå‘é‡ç¶­åº¦ï¼‰
- textsï¼ˆåŸå§‹æ–‡å­—ï¼‰
- embeddingsï¼ˆå‘é‡çµæœï¼‰

### åŸ·è¡Œæ–¹å¼
```bash
python cw01_step3_get_embeddings.py
```

## Step 4ï¼šå‘é‡ä¸Šå‚³è‡³ Qdrantï¼ˆUpsertï¼‰

**æª”æ¡ˆï¼š** `cw01_step4_upsert_to_qdrant.py`

æœ¬æ­¥é©Ÿå°‡ Step 3 ç”¢ç”Ÿçš„å‘é‡è³‡æ–™ä¸Šå‚³è‡³ Qdrant å‘é‡è³‡æ–™åº«ã€‚

### ä½œæ³•èªªæ˜
- è®€å– `embeddings.json`
- å»ºç«‹ / ä½¿ç”¨ collectionï¼š`cw01`
- ä½¿ç”¨ upsert å¯«å…¥å‘é‡è³‡æ–™
- æ¯ä¸€ç­†å‘é‡å°æ‡‰ä¸€å€‹ point_id
- payload ä¸­åŒ…å«ï¼š
  - åŸå§‹æ–‡å­—å…§å®¹
  - chunk_id
  - source è³‡è¨Š

### ç‚ºä»€éº¼éœ€è¦é€™ä¸€æ­¥ï¼Ÿ
- Embedding åªæ˜¯æ•¸å€¼ï¼Œå¿…é ˆå­˜å…¥å‘é‡è³‡æ–™åº«æ‰èƒ½æœå°‹
- Qdrant æä¾›é«˜æ•ˆçš„èªæ„å‘é‡æœå°‹èƒ½åŠ›
- payload å¯è®“æœå°‹çµæœå›æº¯åŸå§‹å…§å®¹

### åŸ·è¡Œæ–¹å¼
```bash
python cw01_step4_upsert_to_qdrant.py
```
## âœ… Step 5ï¼ˆMarkdown å€å¡Šï¼‰

```md
## Step 5ï¼šTop-k èªæ„æœå°‹ï¼ˆRetrieveï¼‰

**æª”æ¡ˆï¼š** `cw01_step5_search_from_qdrant.py`

æœ¬æ­¥é©Ÿè² è²¬å¾ Qdrant ä¸­æœå°‹èˆ‡æŸ¥è©¢èªæ„æœ€ç›¸è¿‘çš„æ–‡å­—å…§å®¹ã€‚

### ä½œæ³•èªªæ˜
1. ä½¿ç”¨ç›¸åŒçš„ Embedding API å°‡æŸ¥è©¢æ–‡å­—è½‰ç‚ºå‘é‡
2. å‘¼å« Qdrant REST API `/points/search`
3. å–å¾— Top-k ç›¸ä¼¼çµæœ

### è¼¸å‡ºå…§å®¹åŒ…å«
- ç›¸ä¼¼åº¦åˆ†æ•¸ï¼ˆscoreï¼‰
- chunk_id
- å°æ‡‰çš„æ–‡å­—å…§å®¹ï¼ˆpayloadï¼‰

### ç¯„ä¾‹è¼¸å‡º
```text
[1] score=0.7665 chunk_id=1
RAG æ˜¯ Retrieval-Augmented Generationï¼Œç”¨æª¢ç´¢å¢å¼·ç”Ÿæˆã€‚
```
## âœ… Step 6ï¼ˆMarkdown å€å¡Šï¼‰

```md
## Step 6ï¼šRAGï¼ˆRetrieve + Generateï¼‰

**æª”æ¡ˆï¼š** `cw01_step6_rag_generate_cloud_llm.py`

æœ¬æ­¥é©Ÿå°‡ Step 5 æœå°‹åˆ°çš„çµæœçµ„åˆç‚º contextï¼Œä¸¦äº¤ç”±é›²ç«¯ LLM ç”¢ç”Ÿæœ€çµ‚å›ç­”ã€‚

### ä½œæ³•èªªæ˜
1. å°‡ Top-k æœå°‹çµæœæ•´ç†æˆ context
2. å‘¼å«å­¸é•·æä¾›çš„ **é›²ç«¯ LLM API**
3. åŒæ™‚å‚³å…¥ï¼š
   - ä½¿ç”¨è€…å•é¡Œ
   - æœå°‹å¾—åˆ°çš„ context
4. ç”¢ç”Ÿ RAG å›ç­”

### RAG çš„æ ¸å¿ƒç²¾ç¥
- LLM ä¸åªä¾è³´è¨“ç·´æ™‚çŸ¥è­˜
- å›ç­”åŸºæ–¼å³æ™‚æª¢ç´¢çš„è³‡æ–™
- é™ä½ hallucination
- æå‡å¯ä¿¡åº¦èˆ‡å¯è§£é‡‹æ€§

### é¡å¤–è¼¸å‡º
- é¡¯ç¤ºå¯¦éš›ä½¿ç”¨åˆ°çš„ `chunk_id`
- æ–¹ä¾¿é©—è­‰ RAG æ˜¯å¦çœŸçš„æœ‰ç”¨åˆ°æª¢ç´¢å…§å®¹

### åŸ·è¡Œæ–¹å¼
```bash
python cw01_step6_rag_generate_cloud_llm.py
```
